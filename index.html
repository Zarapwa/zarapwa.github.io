<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EXCHANGEMINI</title>
  <link rel="stylesheet" href="styles.css?v=mini-1.0.3">
  <script defer src="app.js?v=mini-1.0.3"></script>
</head>
<body class="app-shell">
  <header class="app-header">
    <div class="app-title-block">
      <div class="app-title">EXCHANGEMINI</div>
      <div class="app-subtitle">Deal & Cash Flow Console</div>
    </div>

    <div class="app-header-right">
      <button id="debug-button" class="pill pill-outline">Debug</button>
      <span class="version-pill">v<span id="app-version"></span></span>
    </div>
  </header>

  <nav class="app-nav">
    <button class="pill pill-primary nav-link" data-view="dashboard">Dashboard</button>
    <button class="pill nav-link" data-view="deals">Deals</button>
    <button class="pill nav-link" data-view="transactions">Transactions</button>
    <button class="pill nav-link" data-view="reports">Reports</button>
    <button class="pill nav-link" data-view="new-deal">New Deal</button>
  </nav>

  <main class="app-main">
    <!-- DASHBOARD -->
    <section class="view" data-view="dashboard">
      <div class="card-grid">
        <div class="card">
          <div class="card-label">Total Deals</div>
          <div class="card-value" id="total-deals">0</div>
          <div class="card-caption">Unique Deal IDs</div>
        </div>
        <div class="card">
          <div class="card-label">Today's Deals</div>
          <div class="card-value" id="todays-deals">0</div>
          <div class="card-caption" id="today-label"></div>
        </div>
        <div class="card">
          <div class="card-label">Total Transactions</div>
          <div class="card-value" id="total-transactions">0</div>
          <div class="card-caption">All records from data.json</div>
        </div>
      </div>

      <div class="card">
        <div class="card-label">Deals by Currency</div>
        <div id="currency-summary" class="mini-table"></div>
      </div>
    </section>

    <!-- DEALS -->
    <section class="view view-hidden" data-view="deals">
      <div class="card">
        <div class="card-header-row">
          <div class="card-label">Deals</div>
          <small id="deals-count-label" class="muted"></small>
        </div>
        <div class="table-scroll">
          <table class="data-table">
            <thead>
              <tr>
                <th>Deal ID</th>
                <th>Customer</th>
                <th>Base</th>
                <th>Total Amount</th>
                <th>Tx Count</th>
              </tr>
            </thead>
            <tbody id="deals-tbody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- TRANSACTIONS -->
    <section class="view view-hidden" data-view="transactions">
      <div class="card">
        <div class="card-header-row">
          <div class="card-label">Transactions</div>
          <small id="tx-count-label" class="muted"></small>
        </div>
        <div class="table-scroll">
          <table class="data-table data-table-tight">
            <thead>
              <tr>
                <th>Date</th>
                <th>Deal ID</th>
                <th>Type</th>
                <th>Base</th>
                <th>Amount</th>
                <th>Target</th>
                <th>Payable</th>
              </tr>
            </thead>
            <tbody id="tx-tbody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- REPORTS -->
    <section class="view view-hidden" data-view="reports">
      <div class="card">
        <div class="card-label">Deal Report</div>
        <p class="muted">Choose a deal to generate WhatsApp-style report.</p>
        <div class="field-row">
          <label for="report-deal-select">Deal ID</label>
          <select id="report-deal-select"></select>
        </div>
        <textarea id="report-output" class="report-box" rows="10" readonly></textarea>
      </div>
    </section>

    <!-- NEW DEAL (local only) -->
    <section class="view view-hidden" data-view="new-deal">
      <div class="card">
        <div class="card-label">New Deal (Local Test)</div>
        <p class="muted">
          Adds a transaction only to this device (localStorage).  
          It does <b>not</b> write to data.json on GitHub.
        </p>
        <div class="form-grid">
          <div class="field-row">
            <label>Deal ID</label>
            <input id="nd-deal-id" type="text" placeholder="e.g. GHOR-24Sep2025">
          </div>
          <div class="field-row">
            <label>Date</label>
            <input id="nd-date" type="date">
          </div>
          <div class="field-row">
            <label>Type</label>
            <input id="nd-type" type="text" placeholder="Inflow / Outflow / Conversion">
          </div>
          <div class="field-row">
            <label>Base Currency</label>
            <input id="nd-base" type="text" placeholder="RMB / USD / IRR ...">
          </div>
          <div class="field-row">
            <label>Amount</label>
            <input id="nd-amount" type="number" step="0.01">
          </div>
          <div class="field-row">
            <label>Target Currency</label>
            <input id="nd-target" type="text" placeholder="IRR / USD / AED ...">
          </div>
          <div class="field-row">
            <label>Payable</label>
            <input id="nd-payable" type="number" step="0.01">
          </div>
        </div>
        <button id="nd-save" class="pill pill-primary full-width">Save locally &amp; refresh views</button>
        <p class="muted tiny">
          Tip: use Debug → “Clear local overrides” if you want to remove these test records.
        </p>
      </div>
    </section>
  </main>

  <!-- DEBUG PANEL -->
  <div id="debug-panel" class="debug-panel hidden">
    <div class="debug-inner">
      <div class="debug-header">
        <span>Debug Console</span>
        <button id="debug-close" class="icon-btn">&times;</button>
      </div>
      <pre id="debug-log" class="debug-log"></pre>
      <div class="debug-actions">
        <button id="debug-refresh" class="pill pill-primary">Soft reload data.json</button>
        <button id="debug-clear-local" class="pill pill-outline">Clear local overrides</button>
        <button id="debug-unregister-sw" class="pill pill-danger">Unregister Service Worker</button>
      </div>
    </div>
  </div>
</body>
</html>
